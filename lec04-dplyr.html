<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />




<title>Data wrangling and visualization in the tidyverse</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/lumen.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-1.1/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-1.1/highlight.js"></script>
<link href="site_libs/font-awesome-4.5.0/css/font-awesome.min.css" rel="stylesheet" />
<style type="text/css">

table {
    border-collapse: collapse;
}

thead {
    border-top: solid #DCDCDC;
    border-bottom: solid #DCDCDC;
}

tr.odd {
    background-color: #F8F8F8;
}

tr:last-child {
    border-bottom: solid #DCDCDC;
}

</style>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs && document.readyState && document.readyState === "complete") {
   window.setTimeout(function() {
      hljs.initHighlighting();
   }, 0);
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>


</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 54px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 59px;
  margin-top: -59px;
}

.section h2 {
  padding-top: 59px;
  margin-top: -59px;
}
.section h3 {
  padding-top: 59px;
  margin-top: -59px;
}
.section h4 {
  padding-top: 59px;
  margin-top: -59px;
}
.section h5 {
  padding-top: 59px;
  margin-top: -59px;
}
.section h6 {
  padding-top: 59px;
  margin-top: -59px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>


<div class="container-fluid main-container">

<!-- tabsets -->
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->




<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3,h4",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_').toLowerCase();
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = false;
    options.smoothScroll = false;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}


.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
  padding-left: 25px;
  text-indent: 0;
}

.tocify .list-group-item {
  border-radius: 0px;
}

.tocify-subheader {
  display: inline;
}
.tocify-subheader .tocify-item {
  font-size: 0.95em;
}

</style>

<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">EEB430H1</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">
    <span class="fa fa-map-o"></span>
     
    Syllabus
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-book"></span>
     
    Lectures
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="lec01-introduction.html">Sept. 7: Intro to course, programming, RStudio, and R Markdown</a>
    </li>
    <li>
      <a href="lec02-basic-r.html">Sept. 12: Variable assignment, vectors, functions</a>
    </li>
    <li>
      <a href="lec03-basic-r.html">Sept. 14: Data frames, intro to dplyr</a>
    </li>
    <li>
      <a href="lec04-dplyr.html">Sept. 19: Data wrangling in dplyr, tidy data</a>
    </li>
    <li>
      <a href="lec05-dplyr.html">Sept. 21: More dplyr and tidy data, ggplot intro</a>
    </li>
    <li>
      <a href="lec06-pop-models.html">Sept. 26: Qualitative review of population models</a>
    </li>
    <li>
      <a href="lec07-pop-models.html">Sept. 28: Modelling in R</a>
    </li>
    <li>
      <a href="lec08-stability.html">Oct. 03: Population models in 2 dimensions</a>
    </li>
    <li>
      <a href="lec09-modeling-r.html">Oct. 05: Fixed points, null clines, and stability</a>
    </li>
    <li>
      <a href="lec10-modeling.html">Oct. 10: Fitting models to data</a>
    </li>
    <li>
      <a href="lec11-modeling-r.html">Oct. 12: Statistical/probabilistic modelling in R</a>
    </li>
    <li>
      <a href="lec12-datasets.html">Oct. 17: Introduce data sets, hypotheses, start projects</a>
    </li>
    <li>
      <a href="lec13-projects-r.html">Oct. 19: Project and Git setup in RStudio, tidy data, and project work</a>
    </li>
    <li>
      <a href="lec14-git.html">Oct. 24: Scientific collaboration, Git and GitHub</a>
    </li>
    <li>
      <a href="lec15-data-viz.html">Oct. 26: Data visualization (Part 2) and project work</a>
    </li>
    <li>
      <a href="lec16-data-viz.html">Oct. 31: Project work, data visualizations</a>
    </li>
    <li>
      <a href="lec17-rmarkdown.html">Nov. 02: Reproducible workflow, metadata, R Markdown</a>
    </li>
    <li>
      <a href="lec18-metadata.html">Nov. 14: Metadata and project work</a>
    </li>
    <li class="dropdown-header">Nov. 16: Project work (no lesson)</li>
    <li>
      <a href="lec19-publishing.html">Nov. 21: Preparing a scientific item for academic publishing</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-book"></span>
     
    Assignments
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="assignment-01.html">Assignment 1</a>
    </li>
    <li>
      <a href="assignment-02.html">Assignment 2</a>
    </li>
    <li>
      <a href="assignment-03.html">Assignment 3</a>
    </li>
    <li>
      <a href="assignment-04.html">Assignment 4</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-caret-square-o-right"></span>
     
    Slides
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header"></li>
  </ul>
</li>
<li>
  <a href="resources.html">
    <span class="fa fa-question"></span>
     
    Resources and FAQ
  </a>
</li>
<li>
  <a href="about.html">
    <span class="fa fa-info"></span>
     
    About
  </a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-bars"></span>
     
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="mailto:joel.ostblom@mail.utoronto.ca">
        <span class="fa fa-envelope"></span>
         
        Contact
      </a>
    </li>
    <li>
      <a href="https://github.com/uoftcoders/rcourse">
        <span class="fa fa-github"></span>
         
        GitHub
      </a>
    </li>
  </ul>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Data wrangling and visualization in the tidyverse</h1>

</div>


<blockquote>
<h3 id="learning-objectives">Learning Objectives</h3>
<ul>
<li>Understand the split-apply-combine concept for data analysis.</li>
<li>Use <code>summarize</code>, <code>group_by</code>, and <code>tally</code> to split a data frame into groups of observations, apply a summary statistics for each group, and then combine the results.</li>
<li>Produce scatter plots, line plots, and histograms using ggplot.</li>
<li>Set universal plot settings.</li>
<li>Understand and apply faceting in ggplot.</li>
</ul>
</blockquote>
<blockquote>
<h3 id="lesson-outline">Lesson outline</h3>
<ul>
<li>Split-apply-combine techniques in <strong><code>dplyr</code></strong> (20 min)</li>
<li>Using <code>tally</code> to summarize categorical data (10 min)</li>
<li>Plotting with <strong><code>ggplot2</code></strong> (15 min)</li>
<li>Building plots iteratively (15 min)</li>
<li>Split-apply-combine… plot! (20 min)</li>
<li>Faceting (10 min)</li>
</ul>
</blockquote>
<hr />
<div id="setting-up" class="section level2">
<h2>Setting up</h2>
<p>Start by loading the required packages. Both <strong><code>ggplot2</code></strong> and <strong><code>dplyr</code></strong> are included in the <strong><code>tidyverse</code></strong> package collection.</p>
<pre class="r"><code># Install if needed
# install.packages(&#39;tidyverse&#39;)
library(tidyverse)</code></pre>
<p>Load the data we saved in the previous lesson.</p>
<pre class="r"><code># Download if needed
# download.file(&quot;https://ndownloader.figshare.com/files/2292169&quot;, &quot;data/portal_data.csv&quot;)
surveys &lt;- read_csv(&#39;portal_data.csv&#39;)</code></pre>
<pre><code>## Parsed with column specification:
## cols(
##   record_id = col_integer(),
##   month = col_integer(),
##   day = col_integer(),
##   year = col_integer(),
##   plot_id = col_integer(),
##   species_id = col_character(),
##   sex = col_character(),
##   hindfoot_length = col_integer(),
##   weight = col_integer(),
##   genus = col_character(),
##   species = col_character(),
##   taxa = col_character(),
##   plot_type = col_character()
## )</code></pre>
<pre class="r"><code>surveys</code></pre>
<pre><code>## # A tibble: 34,786 x 13
##    record_id month   day  year plot_id species_id   sex hindfoot_length
##        &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;   &lt;int&gt;      &lt;chr&gt; &lt;chr&gt;           &lt;int&gt;
##  1         1     7    16  1977       2         NL     M              32
##  2        72     8    19  1977       2         NL     M              31
##  3       224     9    13  1977       2         NL  &lt;NA&gt;              NA
##  4       266    10    16  1977       2         NL  &lt;NA&gt;              NA
##  5       349    11    12  1977       2         NL  &lt;NA&gt;              NA
##  6       363    11    12  1977       2         NL  &lt;NA&gt;              NA
##  7       435    12    10  1977       2         NL  &lt;NA&gt;              NA
##  8       506     1     8  1978       2         NL  &lt;NA&gt;              NA
##  9       588     2    18  1978       2         NL     M              NA
## 10       661     3    11  1978       2         NL  &lt;NA&gt;              NA
## # ... with 34,776 more rows, and 5 more variables: weight &lt;int&gt;,
## #   genus &lt;chr&gt;, species &lt;chr&gt;, taxa &lt;chr&gt;, plot_type &lt;chr&gt;</code></pre>
</div>
<div id="split-apply-combine-technique-in-dplyr" class="section level2">
<h2>Split-apply-combine technique in dplyr</h2>
<p>Many data analysis tasks can be approached using the <em>split-apply-combine</em> paradigm: split the data into groups, apply some analysis to each group, and then combine the results.</p>
<p><strong><code>dplyr</code></strong> facilitates this workflow through the use of <code>group_by()</code> to split data and <code>summarize()</code>, which collapses each group into a single-row summary of that group. The arguments to <code>group_by()</code> are the column names that contain the <strong>categorical</strong> variables for which you want to calculate the summary statistics. Let’s view the mean <code>weight</code> by sex.</p>
<pre class="r"><code>surveys %&gt;%
    group_by(sex) %&gt;%
    summarize(mean_weight = mean(weight))</code></pre>
<pre><code>## # A tibble: 3 x 2
##     sex mean_weight
##   &lt;chr&gt;       &lt;dbl&gt;
## 1     F          NA
## 2     M          NA
## 3  &lt;NA&gt;          NA</code></pre>
<p>The mean weights become <code>NA</code> since there are individual observations that are <code>NA</code>. Let’s remove those observations.</p>
<pre class="r"><code>surveys %&gt;%
    filter(!is.na(weight)) %&gt;%
    group_by(sex) %&gt;%
    summarize(mean_weight = mean(weight))</code></pre>
<pre><code>## # A tibble: 3 x 2
##     sex mean_weight
##   &lt;chr&gt;       &lt;dbl&gt;
## 1     F    42.17055
## 2     M    42.99538
## 3  &lt;NA&gt;    64.74257</code></pre>
<p>There is one row here that is neither male nor female, these are observations where the animal escaped before the sex could not be determined. Let’s remove those as well.</p>
<pre class="r"><code>surveys %&gt;%
    filter(!is.na(weight) &amp; !is.na(sex)) %&gt;%
    group_by(sex) %&gt;%
    summarize(mean_weight = mean(weight))</code></pre>
<pre><code>## # A tibble: 2 x 2
##     sex mean_weight
##   &lt;chr&gt;       &lt;dbl&gt;
## 1     F    42.17055
## 2     M    42.99538</code></pre>
<p>You can also group by multiple columns:</p>
<pre class="r"><code>surveys %&gt;%
    filter(!is.na(weight) &amp; !is.na(sex)) %&gt;%
    group_by(genus, sex) %&gt;%
    summarize(mean_weight = mean(weight))</code></pre>
<pre><code>## # A tibble: 20 x 3
## # Groups:   genus [?]
##              genus   sex mean_weight
##              &lt;chr&gt; &lt;chr&gt;       &lt;dbl&gt;
##  1         Baiomys     F    9.161290
##  2         Baiomys     M    7.357143
##  3     Chaetodipus     F   23.763824
##  4     Chaetodipus     M   24.712219
##  5       Dipodomys     F   55.244360
##  6       Dipodomys     M   56.243034
##  7         Neotoma     F  154.282209
##  8         Neotoma     M  165.652893
##  9       Onychomys     F   26.780959
## 10       Onychomys     M   26.246466
## 11     Perognathus     F    8.574803
## 12     Perognathus     M    8.204182
## 13      Peromyscus     F   22.491649
## 14      Peromyscus     M   20.644279
## 15 Reithrodontomys     F   11.220080
## 16 Reithrodontomys     M   10.159941
## 17        Sigmodon     F   71.696000
## 18        Sigmodon     M   61.336842
## 19    Spermophilus     F   57.000000
## 20    Spermophilus     M  130.000000</code></pre>
<p>Since we will use the same filtered and grouped data frame in multiple code chunks below, we could assign this subset of the data to a new variable and use this variable in the subsequent code chunks instead of typing out the functions each time.</p>
<pre class="r"><code>filtered_surveys &lt;- surveys %&gt;%
    filter(!is.na(weight) &amp; !is.na(sex)) %&gt;%
    group_by(genus, sex)</code></pre>
<p>If you want to display more data, you can use the <code>print()</code> function at the end of your chain with the argument <code>n</code> specifying the number of rows to display.</p>
<pre class="r"><code>filtered_surveys %&gt;%
    summarize(mean_weight = mean(weight)) %&gt;%
    print(n = 15) # Will change the knitted output, not the notebook</code></pre>
<pre><code>## # A tibble: 20 x 3
## # Groups:   genus [?]
##              genus   sex mean_weight
##              &lt;chr&gt; &lt;chr&gt;       &lt;dbl&gt;
##  1         Baiomys     F    9.161290
##  2         Baiomys     M    7.357143
##  3     Chaetodipus     F   23.763824
##  4     Chaetodipus     M   24.712219
##  5       Dipodomys     F   55.244360
##  6       Dipodomys     M   56.243034
##  7         Neotoma     F  154.282209
##  8         Neotoma     M  165.652893
##  9       Onychomys     F   26.780959
## 10       Onychomys     M   26.246466
## 11     Perognathus     F    8.574803
## 12     Perognathus     M    8.204182
## 13      Peromyscus     F   22.491649
## 14      Peromyscus     M   20.644279
## 15 Reithrodontomys     F   11.220080
## # ... with 5 more rows</code></pre>
<p>Once the data are grouped, you can also summarize multiple variables at the same time. For instance, we could add a column indicating the minimum weight for each species for each sex:</p>
<pre class="r"><code>filtered_surveys %&gt;%
    summarize(mean_weight = mean(weight),
              min_weight = min(weight))</code></pre>
<pre><code>## # A tibble: 20 x 4
## # Groups:   genus [?]
##              genus   sex mean_weight min_weight
##              &lt;chr&gt; &lt;chr&gt;       &lt;dbl&gt;      &lt;dbl&gt;
##  1         Baiomys     F    9.161290          6
##  2         Baiomys     M    7.357143          6
##  3     Chaetodipus     F   23.763824          5
##  4     Chaetodipus     M   24.712219          4
##  5       Dipodomys     F   55.244360         10
##  6       Dipodomys     M   56.243034         12
##  7         Neotoma     F  154.282209         32
##  8         Neotoma     M  165.652893         30
##  9       Onychomys     F   26.780959          5
## 10       Onychomys     M   26.246466          9
## 11     Perognathus     F    8.574803          4
## 12     Perognathus     M    8.204182          4
## 13      Peromyscus     F   22.491649          8
## 14      Peromyscus     M   20.644279          7
## 15 Reithrodontomys     F   11.220080          4
## 16 Reithrodontomys     M   10.159941          4
## 17        Sigmodon     F   71.696000         15
## 18        Sigmodon     M   61.336842         16
## 19    Spermophilus     F   57.000000         57
## 20    Spermophilus     M  130.000000        130</code></pre>
<blockquote>
<h4 id="challenge">Challenge</h4>
<ol style="list-style-type: decimal">
<li><p>Use <code>group_by()</code> and <code>summarize()</code> to find the mean, min, and max hindfoot length for each species.</p></li>
<li><p>What was the heaviest animal measured in each year? Return the columns <code>year</code>, <code>genus</code>, <code>species</code>, and <code>weight</code>.</p></li>
</ol>
</blockquote>
<!--
```
## Answer 1
surveys %>%
    filter(!is.na(hindfoot_length)) %>%
    group_by(species) %>%
    summarize(
        mean_hindfoot_length = mean(hindfoot_length),
        min_hindfoot_length = min(hindfoot_length),
        max_hindfoot_length = max(hindfoot_length)
    )
## Answer 2
surveys %>%
    filter(!is.na(weight)) %>%
    group_by(year) %>%
    filter(weight == max(weight)) %>% # This is going to compare to the max weight within each group
    select(year, genus, species, weight) %>%
    arrange(year)
```
-->
<div id="using-tally-to-summarize-categorical-data" class="section level3">
<h3>Using tally to summarize categorical data</h3>
<p>When working with data, it is also common to want to know the number of observations found for each factor or combination of factors. For this, <strong><code>dplyr</code></strong> provides <code>tally()</code>. For example, if we want to group by taxa and find the number of observations for each taxa, we would do:</p>
<pre class="r"><code>surveys %&gt;%
    group_by(taxa) %&gt;%
    tally()</code></pre>
<pre><code>## # A tibble: 4 x 2
##      taxa     n
##     &lt;chr&gt; &lt;int&gt;
## 1    Bird   450
## 2  Rabbit    75
## 3 Reptile    14
## 4  Rodent 34247</code></pre>
<p>We can also use <code>tally()</code> when grouping on multiple variables:</p>
<pre class="r"><code>surveys %&gt;%
    group_by(taxa, sex) %&gt;%
    tally()</code></pre>
<pre><code>## # A tibble: 6 x 3
## # Groups:   taxa [?]
##      taxa   sex     n
##     &lt;chr&gt; &lt;chr&gt; &lt;int&gt;
## 1    Bird  &lt;NA&gt;   450
## 2  Rabbit  &lt;NA&gt;    75
## 3 Reptile  &lt;NA&gt;    14
## 4  Rodent     F 15690
## 5  Rodent     M 17348
## 6  Rodent  &lt;NA&gt;  1209</code></pre>
<p>Here, <code>tally()</code> is the action applied to the groups created by <code>group_by()</code> and counts the total number of records for each category.</p>
<p>If there are many groups, <code>tally()</code> is not that useful on its own. For example, when we want to view the five most abundant species among the observations:</p>
<pre class="r"><code>surveys %&gt;%
    group_by(species) %&gt;%
    tally()</code></pre>
<pre><code>## # A tibble: 40 x 2
##            species     n
##              &lt;chr&gt; &lt;int&gt;
##  1        albigula  1252
##  2       audubonii    75
##  3         baileyi  2891
##  4       bilineata   303
##  5 brunneicapillus    50
##  6       chlorurus    39
##  7          clarki     1
##  8        eremicus  1299
##  9          flavus  1597
## 10      fulvescens    75
## # ... with 30 more rows</code></pre>
<p>Since there are 40 rows in this output, we would like to order the table to display the most abundant species first. In <code>dplyr</code>, we say that we want to <code>arrange()</code> the data.</p>
<pre class="r"><code>surveys %&gt;%
    group_by(species) %&gt;%
    tally() %&gt;%
    arrange(n)</code></pre>
<pre><code>## # A tibble: 40 x 2
##         species     n
##           &lt;chr&gt; &lt;int&gt;
##  1       clarki     1
##  2   scutalatus     1
##  3 tereticaudus     1
##  4       tigris     1
##  5    uniparens     1
##  6      viridis     1
##  7   leucophrys     2
##  8   savannarum     2
##  9       fuscus     5
## 10    undulatus     5
## # ... with 30 more rows</code></pre>
<p>Still not that useful. Since we are interested in the most abundant species, we want to display those with the highest count first, in other words, we want to arrange the column <code>n</code> in descending order:</p>
<pre class="r"><code>surveys %&gt;%
    group_by(species) %&gt;%
    tally() %&gt;%
    arrange(desc(n)) %&gt;%
    head(5)</code></pre>
<pre><code>## # A tibble: 5 x 2
##        species     n
##          &lt;chr&gt; &lt;int&gt;
## 1     merriami 10596
## 2 penicillatus  3123
## 3        ordii  3027
## 4      baileyi  2891
## 5    megalotis  2609</code></pre>
<p>If we want to include more attributes about these species, we can include these in the call to <code>group_by()</code>:</p>
<pre class="r"><code>surveys %&gt;%
    group_by(species, taxa, genus) %&gt;%
    tally() %&gt;%
    arrange(desc(n)) %&gt;%
    head(5)</code></pre>
<pre><code>## # A tibble: 5 x 4
## # Groups:   species, taxa [5]
##        species   taxa           genus     n
##          &lt;chr&gt;  &lt;chr&gt;           &lt;chr&gt; &lt;int&gt;
## 1     merriami Rodent       Dipodomys 10596
## 2 penicillatus Rodent     Chaetodipus  3123
## 3        ordii Rodent       Dipodomys  3027
## 4      baileyi Rodent     Chaetodipus  2891
## 5    megalotis Rodent Reithrodontomys  2609</code></pre>
<p>Be careful not to include anything that would split the group into subgroups, such as <code>sex</code>, <code>year</code> etc.</p>
<blockquote>
<h4 id="challenge-1">Challenge</h4>
<ol style="list-style-type: decimal">
<li><p>How many individuals were caught in each <code>plot_type</code> surveyed?</p></li>
<li><p>You saw above how to count the number of individuals of each <code>sex</code> using a combination of <code>group_by()</code> and <code>tally()</code>. How could you get the same result using <code>group_by()</code> and <code>summarize()</code>? Hint: see <code>?n</code>.</p></li>
</ol>
</blockquote>
<!---

```
## # A tibble: 5 x 2
##                   plot_type     n
##                       <chr> <int>
## 1                   Control 15611
## 2  Long-term Krat Exclosure  5118
## 3          Rodent Exclosure  4233
## 4 Short-term Krat Exclosure  5906
## 5         Spectab exclosure  3918
```

```
## # A tibble: 3 x 2
##     sex     n
##   <chr> <int>
## 1     F 15690
## 2     M 17348
## 3  <NA>  1748
```
--->
</div>
</div>
<div id="plotting-with-ggplot2" class="section level2">
<h2>Plotting with ggplot2</h2>
<p><strong><code>ggplot2</code></strong> is a plotting package that makes it simple to create complex plots from data frames. The name <strong><code>ggplot2</code></strong> comes from its inspiration, the book “A grammar of graphics”, and the main goal is to allow coders to express their desired outcome on a high level instead of telling the computer every detail about what will happen. For example, you would say “color my data by species” instead of “go through this data frame and plot any observations of species1 in blue, any observations of species2 in red, etc”. Thanks to this functional way of interfaces with data, only minimal changes are required if the underlying data change or to change the type of plot. This helps in thinking about the data and creating publication quality plots with minimal amounts of adjustments and tweaking.</p>
<p>ggplot graphics are built step by step by adding new elements, or layers. Adding layers in this fashion allows for extensive flexibility and customization of plots. To build a ggplot, we need to:</p>
<ol style="list-style-type: decimal">
<li>Use the <code>ggplot()</code> function and bind the plot to a specific data frame using the <code>data</code> argument</li>
</ol>
<pre class="r"><code>ggplot(data = surveys)</code></pre>
<p><img src="lec04-dplyr_files/figure-html/unnamed-chunk-17-1.png" width="672" /></p>
<p>Remember, if the arguments are provided in the right order then the names of the arguments can be omitted.</p>
<pre class="r"><code>ggplot(surveys)</code></pre>
<p><img src="lec04-dplyr_files/figure-html/unnamed-chunk-18-1.png" width="672" /></p>
<ol start="2" style="list-style-type: decimal">
<li>Define aesthetics (<code>aes</code>), by selecting the variables to be plotted and the variables to define the presentation such as plotting size, shape color, etc.</li>
</ol>
<pre class="r"><code>ggplot(surveys, aes(x = weight, y = hindfoot_length))</code></pre>
<p><img src="lec04-dplyr_files/figure-html/unnamed-chunk-19-1.png" width="672" /></p>
<ol start="3" style="list-style-type: decimal">
<li>Add <code>geoms</code> – geometrical objects as a graphical representation of the data in the plot (points, lines, bars). <strong><code>ggplot2</code></strong> offers many different geoms; we will use a few common ones today, including:
<ul>
<li><code>geom_point()</code> for scatter plots, dot plots, etc.</li>
<li><code>geom_line()</code> for trend lines, time-series, etc.</li>
<li><code>geom_histogram()</code> for histograms</li>
</ul></li>
</ol>
<p>To add a geom to the plot use <code>+</code> operator. Because we have two continuous variables, let’s use <code>geom_point()</code> first:</p>
<pre class="r"><code># If this takes way too long on your machine, create a subset from a random
# sample of a suitable size and continue working with this instead of `survey`.
#survey_subset &lt;- sample_n(surveys, size = 5000)

ggplot(surveys, aes(x = weight, y = hindfoot_length)) +
  geom_point()</code></pre>
<pre><code>## Warning: Removed 4048 rows containing missing values (geom_point).</code></pre>
<p><img src="lec04-dplyr_files/figure-html/unnamed-chunk-20-1.png" width="672" /></p>
<p>The <code>+</code> in the <strong><code>ggplot2</code></strong> package is particularly useful because it allows you to modify existing <code>ggplot</code> objects. This means you can easily set up plot “templates” and conveniently explore different types of plots, so the above plot can also be generated with code like this:</p>
<pre class="r"><code># Assign plot to a variable
surveys_plot &lt;- ggplot(surveys, aes(x = weight, y = hindfoot_length))

# Draw the plot
surveys_plot + geom_point()</code></pre>
<pre><code>## Warning: Removed 4048 rows containing missing values (geom_point).</code></pre>
<p><img src="lec04-dplyr_files/figure-html/first-ggplot-with-plus-1.png" width="672" /></p>
<p>Notes:</p>
<ul>
<li>Anything you put in the <code>ggplot()</code> function can be seen by any geom layers that you add (i.e., these are universal plot settings). This includes the x and y axis you set up in <code>aes()</code>.</li>
<li>You can also specify aesthetics for a given geom independently of the aesthetics defined globally in the <code>ggplot()</code> function.</li>
<li>The <code>+</code> sign used to add layers must be placed at the end of each line containing a layer. If, instead, the <code>+</code> sign is added in the line before the other layer, <strong><code>ggplot2</code></strong> will not add the new layer and R will return an error message.</li>
</ul>
<div id="building-plots-iteratively" class="section level3">
<h3>Building plots iteratively</h3>
<p>Building plots with ggplot is typically an iterative process. We start by defining the dataset we’ll use, lay the axes, and choose a geom:</p>
<pre class="r"><code>ggplot(surveys, aes(x = weight, y = hindfoot_length)) +
    geom_point()</code></pre>
<pre><code>## Warning: Removed 4048 rows containing missing values (geom_point).</code></pre>
<p><img src="lec04-dplyr_files/figure-html/unnamed-chunk-21-1.png" width="672" /></p>
<p>Then, we start modifying this plot to extract more information from it. For instance, we can add transparency (<code>alpha</code>) to reduce overplotting:</p>
<pre class="r"><code>ggplot(data = surveys, aes(x = weight, y = hindfoot_length)) +
    geom_point(alpha = 0.2)</code></pre>
<pre><code>## Warning: Removed 4048 rows containing missing values (geom_point).</code></pre>
<p><img src="lec04-dplyr_files/figure-html/unnamed-chunk-22-1.png" width="672" /></p>
<p>Based on the hindfoot length and the weights, there appears to be 4-5 clusters in this data. Potentially, one of the categorical variables we have in the data could explain this pattern. Coloring the data points according to a categorical variable is an easy way to find out if there seems to be correlation. Let’s try this with <code>plot_type</code>.</p>
<pre class="r"><code>ggplot(surveys, aes(x = weight, y = hindfoot_length, color = plot_type)) +
    geom_point(alpha = 0.2)</code></pre>
<pre><code>## Warning: Removed 4048 rows containing missing values (geom_point).</code></pre>
<p><img src="lec04-dplyr_files/figure-html/unnamed-chunk-23-1.png" width="672" /></p>
<p>It seems like the type of plot the animal was captured on correlates well with some of these clusters, but there are still many that are quite mixed. Let’s try to do better! This time, the information about the data can provide some clues to which variable to look at. The plot above suggests that there might be 4-5 clusters, so a variable with 4-5 values is a good guess for what could explain the observed pattern in the scatter plot.</p>
<pre class="r"><code>surveys %&gt;%
    summarize_all(n_distinct)</code></pre>
<pre><code>## # A tibble: 1 x 13
##   record_id month   day  year plot_id species_id   sex hindfoot_length
##       &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;   &lt;int&gt;      &lt;int&gt; &lt;int&gt;           &lt;int&gt;
## 1     34786    12    31    26      24         48     3              57
## # ... with 5 more variables: weight &lt;int&gt;, genus &lt;int&gt;, species &lt;int&gt;,
## #   taxa &lt;int&gt;, plot_type &lt;int&gt;</code></pre>
<p>Remember that there are still <code>NA</code> values here, that’s why there appears to be three sexes although there is only male and female. There are four taxa so that could be a good candidate, let’s see which those are.</p>
<pre class="r"><code>surveys %&gt;%
    distinct(taxa)</code></pre>
<pre><code>## # A tibble: 4 x 1
##      taxa
##     &lt;chr&gt;
## 1  Rodent
## 2  Rabbit
## 3    Bird
## 4 Reptile</code></pre>
<p>It seems reasonable that these taxa contain animals different enough to have diverse weights and length of their feet. Lets use this categorical variable to color the scatter plot.</p>
<pre class="r"><code>ggplot(surveys, aes(x = weight, y = hindfoot_length, color = taxa)) +
    geom_point(alpha = 0.2)</code></pre>
<pre><code>## Warning: Removed 4048 rows containing missing values (geom_point).</code></pre>
<p><img src="lec04-dplyr_files/figure-html/unnamed-chunk-26-1.png" width="672" /></p>
<p>Only rodents? That was unexpected… Let’s check what’s going on.</p>
<pre class="r"><code>surveys %&gt;%
    group_by(taxa) %&gt;%
    tally()</code></pre>
<pre><code>## # A tibble: 4 x 2
##      taxa     n
##     &lt;chr&gt; &lt;int&gt;
## 1    Bird   450
## 2  Rabbit    75
## 3 Reptile    14
## 4  Rodent 34247</code></pre>
<p>There is definitely mostly rodents in our data set…</p>
<pre class="r"><code>surveys %&gt;%
    filter(!is.na(hindfoot_length)) %&gt;% # control by removing `!`
    group_by(taxa) %&gt;%
    tally()</code></pre>
<pre><code>## # A tibble: 1 x 2
##     taxa     n
##    &lt;chr&gt; &lt;int&gt;
## 1 Rodent 31438</code></pre>
<p>…and it turns out that only rodents, have had their hindfeet measured!</p>
<p>Let’s remove all animals that did not have their hindfeet measured, including those rodents that did not. Animals without their weight measured will also be removed.</p>
<pre class="r"><code>surveys_hf_wt &lt;- surveys %&gt;%
    filter(!is.na(hindfoot_length) &amp; !is.na(weight))

surveys_hf_wt %&gt;%
    summarize_all(n_distinct)</code></pre>
<pre><code>## # A tibble: 1 x 13
##   record_id month   day  year plot_id species_id   sex hindfoot_length
##       &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;   &lt;int&gt;      &lt;int&gt; &lt;int&gt;           &lt;int&gt;
## 1     30738    12    31    26      24         24     3              55
## # ... with 5 more variables: weight &lt;int&gt;, genus &lt;int&gt;, species &lt;int&gt;,
## #   taxa &lt;int&gt;, plot_type &lt;int&gt;</code></pre>
<p>Maybe the genus can explain what we are seeing.</p>
<pre class="r"><code>ggplot(surveys_hf_wt, aes(x = weight, y = hindfoot_length, color = genus)) +
    geom_point(alpha = 0.2)</code></pre>
<p><img src="lec04-dplyr_files/figure-html/unnamed-chunk-30-1.png" width="672" /></p>
<p>Now this looks good! There is a clear separation between different genus, but also significant spread within genus, for example in the weight of the green Neotoma observations. There are also two clearly separate clusters that are both colored in olive green (Dipodomys). Maybe separating the observations into different species would be better?</p>
<pre class="r"><code>ggplot(surveys_hf_wt, aes(x = weight, y = hindfoot_length, color = species)) +
    geom_point(alpha = 0.2)</code></pre>
<p><img src="lec04-dplyr_files/figure-html/unnamed-chunk-31-1.png" width="672" /></p>
<p>Great! Together with the genus plot, this definitely seem to explain most of the variance we see in the hindfoot length and weight measurements. It is still a bit messy as it appears like we have around 5 clusters, but there are 21 species in the legend.</p>
<pre class="r"><code>surveys %&gt;%
    filter(!is.na(hindfoot_length) &amp; !is.na(weight)) %&gt;%
    group_by(species) %&gt;%
    tally() %&gt;%
    arrange(desc(n))</code></pre>
<pre><code>## # A tibble: 21 x 2
##         species     n
##           &lt;chr&gt; &lt;int&gt;
##  1     merriami  9739
##  2 penicillatus  2978
##  3      baileyi  2808
##  4        ordii  2793
##  5    megalotis  2429
##  6     torridus  2085
##  7  spectabilis  2026
##  8       flavus  1471
##  9     eremicus  1200
## 10     albigula  1046
## # ... with 11 more rows</code></pre>
<p>There is a big drop from 838 to 159, let’s include only those with more than 800 observations.</p>
<pre class="r"><code>abundant_species &lt;- surveys %&gt;%
    filter(!is.na(hindfoot_length) &amp; !is.na(weight)) %&gt;%
    group_by(species) %&gt;%
    tally() %&gt;%
    arrange(desc(n)) %&gt;%
    filter(n &gt; 800) %&gt;% #
    select(species)

abundant_species</code></pre>
<pre><code>## # A tibble: 12 x 1
##         species
##           &lt;chr&gt;
##  1     merriami
##  2 penicillatus
##  3      baileyi
##  4        ordii
##  5    megalotis
##  6     torridus
##  7  spectabilis
##  8       flavus
##  9     eremicus
## 10     albigula
## 11  leucogaster
## 12  maniculatus</code></pre>
<pre class="r"><code>surveys_abun_species &lt;- surveys %&gt;%
    filter(!is.na(hindfoot_length) &amp;
        !is.na(weight) &amp;
        species %in% abundant_species$species)

surveys_abun_species</code></pre>
<pre><code>## # A tibble: 30,320 x 13
##    record_id month   day  year plot_id species_id   sex hindfoot_length
##        &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;   &lt;int&gt;      &lt;chr&gt; &lt;chr&gt;           &lt;int&gt;
##  1       845     5     6  1978       2         NL     M              32
##  2      1164     8     5  1978       2         NL     M              34
##  3      1261     9     4  1978       2         NL     M              32
##  4      1756     4    29  1979       2         NL     M              33
##  5      1818     5    30  1979       2         NL     M              32
##  6      1882     7     4  1979       2         NL     M              32
##  7      2133    10    25  1979       2         NL     F              33
##  8      2184    11    17  1979       2         NL     F              30
##  9      2406     1    16  1980       2         NL     F              33
## 10      3000     5    18  1980       2         NL     F              31
## # ... with 30,310 more rows, and 5 more variables: weight &lt;int&gt;,
## #   genus &lt;chr&gt;, species &lt;chr&gt;, taxa &lt;chr&gt;, plot_type &lt;chr&gt;</code></pre>
<p>Still has almost 25k observations, so only 10k was removed.</p>
<pre class="r"><code>ggplot(surveys_abun_species, aes(x = weight, y = hindfoot_length, color = species)) +
    geom_point(alpha = 0.2)</code></pre>
<p><img src="lec04-dplyr_files/figure-html/unnamed-chunk-35-1.png" width="672" /></p>
<blockquote>
<h4 id="challenge-2">Challenge</h4>
<p>Create a scatter plot of <code>hindfoot_length</code> over <code>species</code> with the <code>weight</code> showing in different colors. Is there any problem with this plot? <em>Hint: think about how many observations there are</em></p>
</blockquote>
<!--

```r
ggplot(surveys_abun_species, aes(x = weight, y = species, color = hindfoot_length)) +
    geom_point(size = 0.1, position = 'jitter')
```

<img src="lec04-dplyr_files/figure-html/unnamed-chunk-36-1.png" width="672" />
-->
</div>
<div id="split-apply-combine-plot" class="section level3">
<h3>Split-apply-combine… plot!</h3>
<p>In this section, we will learn how to work with <code>**dplyr**</code> and <code>**ggplot**</code> together. Aided by the pipes (<code>%&gt;%</code>), we can create a powerful data exploration workflow using these two packages.</p>
<p>Let’s calculate number of counts per year for each species. First we need to group the data and count records within each group:</p>
<pre class="r"><code>surveys_abun_species %&gt;%
    group_by(year, genus) %&gt;%
    tally() %&gt;%
    arrange(desc(n)) # Adding arrange just to compare with histogram</code></pre>
<pre><code>## # A tibble: 178 x 3
## # Groups:   year [26]
##     year       genus     n
##    &lt;int&gt;       &lt;chr&gt; &lt;int&gt;
##  1  2002 Chaetodipus  1243
##  2  1983   Dipodomys   953
##  3  1985   Dipodomys   951
##  4  2000 Chaetodipus   913
##  5  1982   Dipodomys   896
##  6  1997   Dipodomys   830
##  7  2001 Chaetodipus   781
##  8  1981   Dipodomys   733
##  9  1987   Dipodomys   688
## 10  1980   Dipodomys   667
## # ... with 168 more rows</code></pre>
<p>We could assign this table to a variable, and then pass that variable to <code>ggplot()</code>.</p>
<pre class="r"><code>yearly_counts &lt;- surveys_abun_species %&gt;%
    group_by(year, species) %&gt;%
    tally()

ggplot(yearly_counts, aes(x = n)) +
    geom_histogram()</code></pre>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<p><img src="lec04-dplyr_files/figure-html/unnamed-chunk-38-1.png" width="672" /></p>
<p>Creating an intermediate variable would be preferable for time consuming calculations, because you would not want to do that operation every time you change the plot aesthetics.</p>
<p>If it is not a time consuming calculation or you would like the flexibility of changing the data summary and the plotting options in the same code chunk, you can pipe the output of your split-apply-combine operation to the plotting command:</p>
<pre class="r"><code>surveys_abun_species %&gt;%
    group_by(year, species) %&gt;%
    tally() %&gt;%
    ggplot(aes(x = n)) +
        geom_histogram()</code></pre>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<p><img src="lec04-dplyr_files/figure-html/unnamed-chunk-39-1.png" width="672" /></p>
<p>We can perform a quick check that the plot corresponds to the table by coloring the histogram by species:</p>
<pre class="r"><code>surveys_abun_species %&gt;%
    group_by(year, species) %&gt;%
    tally() %&gt;%
    ggplot(aes(x = n, fill = species)) + # `fill` is specific for histograms
        geom_histogram()</code></pre>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<p><img src="lec04-dplyr_files/figure-html/unnamed-chunk-40-1.png" width="672" /></p>
<p>Let’s explore how the number of each genus varies over time. Longitudinal data can be visualized as a line plot with years on the x axis and counts on the y axis:</p>
<pre class="r"><code>surveys_abun_species %&gt;%
    group_by(year, species) %&gt;%
    tally() %&gt;%
    ggplot(aes(x = year, y = n)) +
        geom_line()</code></pre>
<p><img src="lec04-dplyr_files/figure-html/unnamed-chunk-41-1.png" width="672" /></p>
<p>Unfortunately, this does not work because we plotted data for all the species together. We need to tell ggplot to draw a line for each species by modifying the aesthetic function to include <code>group = species</code>:</p>
<pre class="r"><code>surveys_abun_species %&gt;%
    group_by(year, species) %&gt;%
    tally() %&gt;%
    ggplot(aes(x = year, y = n, group = species)) +
        geom_line()</code></pre>
<p><img src="lec04-dplyr_files/figure-html/unnamed-chunk-42-1.png" width="672" /></p>
<p>We will be able to distinguish species in the plot if we add colors (using <code>color</code> also automatically groups the data):</p>
<pre class="r"><code>surveys_abun_species %&gt;%
    group_by(year, species) %&gt;%
    tally() %&gt;%
    ggplot(aes(x = year, y = n, color = species)) + # `color` groups automatically
        geom_line() # try adding `size = 2`</code></pre>
<p><img src="lec04-dplyr_files/figure-html/unnamed-chunk-43-1.png" width="672" /></p>
</div>
<div id="faceting" class="section level3">
<h3>Faceting</h3>
<p>ggplot has a special technique called <em>faceting</em> that allows the user to split one plot into multiple subplots based on a variable included in the dataset. We will use it to make a time series plot for each species:</p>
<pre class="r"><code>surveys_abun_species %&gt;%
    group_by(year, species) %&gt;%
    tally() %&gt;%
    ggplot(aes(x = year, y = n)) + #
        geom_line() +
        facet_wrap(~ species)</code></pre>
<p><img src="lec04-dplyr_files/figure-html/unnamed-chunk-44-1.png" width="672" /></p>
<p>Now we would like to split the line in each plot by the sex of each individual measured. To do that we need to make counts in the data frame grouped by <code>year</code>, <code>species</code>, and <code>sex</code>:</p>
<pre class="r"><code>surveys_abun_species %&gt;%
    group_by(year, species, sex) %&gt;%
    tally()</code></pre>
<pre><code>## # A tibble: 575 x 4
## # Groups:   year, species [?]
##     year     species   sex     n
##    &lt;int&gt;       &lt;chr&gt; &lt;chr&gt; &lt;int&gt;
##  1  1977    eremicus     M     2
##  2  1977      flavus     F    14
##  3  1977      flavus     M     8
##  4  1977 leucogaster     F     1
##  5  1977 leucogaster  &lt;NA&gt;     1
##  6  1977   megalotis     F     1
##  7  1977   megalotis     M     1
##  8  1977    merriami     F    75
##  9  1977    merriami     M   106
## 10  1977       ordii     F    10
## # ... with 565 more rows</code></pre>
<p>We can make the faceted plot by splitting further by sex using <code>color</code> (within a single plot):</p>
<pre class="r"><code>surveys_abun_species %&gt;%
    group_by(year, species, sex) %&gt;%
    tally() %&gt;%
    ggplot(aes(x = year, y = n, color = sex)) +
        geom_line() +
        facet_wrap(~ species)</code></pre>
<p><img src="lec04-dplyr_files/figure-html/unnamed-chunk-46-1.png" width="672" /></p>
<p>There are several observations where no sex was recorded. In this case, we are not really interested in the observations of unknown sex, so we can filter out those values.</p>
<pre class="r"><code>surveys_abun_species %&gt;%
    filter(!is.na(sex)) %&gt;%
    group_by(year, species, sex) %&gt;%
    tally() %&gt;%
    ggplot(aes(x = year, y = n, color = sex)) +
        geom_line() +
        facet_wrap(~ species)</code></pre>
<p><img src="lec04-dplyr_files/figure-html/unnamed-chunk-47-1.png" width="672" /></p>
<p>It is possible to specify exactly which colors to use, to avoid those that are hard to distinguish. We can also change the thickness of the lines, and adjust the x labels so that they don’t overlap. This will be discussed in detail in the data visualization lecture.</p>
<pre class="r"><code>color_names &lt;- c(&#39;black&#39;, &#39;orange&#39;)

surveys_abun_species %&gt;%
    filter(!is.na(sex)) %&gt;%
    group_by(year, species, sex) %&gt;%
    tally() %&gt;%
    ggplot(aes(x = year, y = n, color = sex)) +
        geom_line(size = 1) +
        scale_color_manual(values = color_names) +
        facet_wrap(~ species) +
        theme_bw() +
        theme(text = element_text(size=12),
               axis.text.x = element_text(angle=30, hjust=1))</code></pre>
<p><img src="lec04-dplyr_files/figure-html/unnamed-chunk-48-1.png" width="672" /></p>
<blockquote>
<h4 id="challenge-3">Challenge</h4>
<p>Use the filtered data frame for all of these questions.</p>
</blockquote>
<blockquote>
<ol style="list-style-type: decimal">
<li>Remember the histogram colored according to each species? Starting from that code, how could we separate each species into its own subplot?</li>
<li></li>
</ol>
<ol style="list-style-type: lower-alpha">
<li>Which year was the average weight of the animals the highest?</li>
<li>Is the yearly trend the same for all species?</li>
</ol>
</blockquote>
<!--
# Answers


```r
# 1
ggplot(yearly_counts, aes(x = n, fill = species)) +
    geom_histogram() +
    facet_wrap(~ species)
```

```
## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.
```

<img src="lec04-dplyr_files/figure-html/unnamed-chunk-49-1.png" width="672" />


```r
# 2.a
surveys_abun_species %>%
    filter(!is.na(weight)) %>%
    group_by(year) %>%
    summarize(mean_weight = mean(weight)) %>%
    ggplot(aes(x = year, y = mean_weight)) +
        geom_line()
```

<img src="lec04-dplyr_files/figure-html/unnamed-chunk-50-1.png" width="672" />


```r
# 2.b
surveys_abun_species %>%
    filter(!is.na(weight)) %>%
    group_by(year, species) %>%
    summarize(mean_weight = mean(weight)) %>%
    ggplot(aes(x = year, y = mean_weight, color = species)) +
        geom_line() +
        facet_wrap(~ species)
```

<img src="lec04-dplyr_files/figure-html/unnamed-chunk-51-1.png" width="672" />

-->
<p><em>Parts of this lesson material were taken and modified from <a href="http://datacarpentry.org">Data Carpentry</a> under their CC-BY copyright license. See their <a href="http://www.datacarpentry.org/R-ecology-lesson/03-dplyr.html">lesson page</a> for the original source.</em></p>
</div>
</div>


<hr>

<p>This work is licensed under a <a href="https://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>. See the <a href="LICENSE.html">licensing</a> page for more details about copyright information.</p>


</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
